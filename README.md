# FandomatTest - Android Logging Application

Приложение для тестирования периодического логирования на Android с возможностью симуляции различных сбоев.

## Основные возможности

### 1. Периодическое логирование
- Запись логов в файл `logfile.txt` в папке Downloads
- Настраиваемый интервал логирования (в секундах)
- **Логирование продолжается даже после:**
  - Закрытия приложения
  - Перезапуска приложения
  - Перезагрузки телефона
- Логирование останавливается только при нажатии кнопки "Стоп логирования"

### 2. Управляющие кнопки
- **Старт логирования** - запускает фоновую службу логирования
- **Стоп логирования** - останавливает логирование
- **Сломать приложение** - вызывает RuntimeException (логирует перед крашем)
- **Зависнуть** - блокирует главный поток (логирует перед зависанием)
- **Сбросить приложение** - перезапускает MainActivity (логирует перед сбросом)
- **Очистить логи** - удаляет файл logfile.txt (логирует перед очисткой)
- **Выход** - корректно завершает приложение (логирует перед выходом)

### 3. Формат логов
```
[2025-10-13 14:30:15] Log entry #1: application running normally
[2025-10-13 14:30:25] Log entry #2: application running normally
[2025-10-13 14:31:30] User triggered: App freeze
[2025-10-13 14:33:15] User triggered: App reset
```

## Технические детали

### Архитектура
- **Foreground Service** - для непрерывного логирования в фоне
- **SharedPreferences** - для сохранения состояния логирования
- **BootReceiver** - для автозапуска после перезагрузки телефона
- **Notifications** - отображение статуса логирования в уведомлениях
- **MediaStore API** - для записи в Downloads на Android 11+

### Требования
- **minSdkVersion**: 30 (Android 11)
- **targetSdkVersion**: 36
- **Language**: Kotlin
- **UI**: Jetpack Compose + Material3

### Разрешения
- `FOREGROUND_SERVICE` - для фоновой службы
- `POST_NOTIFICATIONS` - для отображения уведомлений
- `RECEIVE_BOOT_COMPLETED` - для автозапуска после перезагрузки
- `READ/WRITE_EXTERNAL_STORAGE` - для Android 9 и ниже

## Как работает персистентность

1. **При нажатии "Старт логирования":**
   - Состояние сохраняется в SharedPreferences
   - Запускается Foreground Service
   - Отображается уведомление о работе службы

2. **При перезапуске приложения:**
   - MainActivity проверяет SharedPreferences
   - Если логирование было активно - служба запускается автоматически

3. **При перезагрузке телефона:**
   - BootReceiver получает событие BOOT_COMPLETED
   - Проверяет состояние в SharedPreferences
   - Запускает службу, если логирование было активно

4. **При нажатии "Стоп логирования":**
   - Состояние обновляется в SharedPreferences
   - Служба останавливается
   - Уведомление исчезает

## Файловая структура

```
app/src/main/java/com/tastamat/fandomat/
├── MainActivity.kt         # Главный экран приложения
├── LoggingService.kt       # Фоновая служба для логирования
├── BootReceiver.kt         # Receiver для автозапуска после перезагрузки
└── ui/theme/              # Тема приложения
```

## Сборка и запуск

```bash
# Клонирование репозитория
git clone https://github.com/Bahrulloif/fandomattest.git

# Открыть в Android Studio
# Синхронизировать Gradle
# Запустить на устройстве или эмуляторе (Android 11+)
```

## Тестирование персистентности

1. Запустите приложение
2. Введите интервал (например, 10 секунд)
3. Нажмите "Старт логирования"
4. Проверьте файл `/storage/emulated/0/Download/logfile.txt`
5. Закройте приложение полностью (свайпните из списка приложений)
6. Подождите несколько интервалов
7. Откройте файл - логи продолжают добавляться!
8. Перезагрузите телефон
9. Логирование автоматически возобновится

## Остановка логирования

**Важно:** Логирование будет продолжаться бесконечно, пока вы не:
1. Откроете приложение
2. Нажмете кнопку "Стоп логирования"

Или удалите/переустановите приложение.

## Известные ограничения

- На некоторых устройствах производители могут агрессивно убивать фоновые службы для экономии батареи
- Для надежной работы может потребоваться отключить оптимизацию батареи для приложения
- Foreground Service отображает постоянное уведомление (требование Android)

## Лицензия

Этот проект создан для тестирования и обучения.
